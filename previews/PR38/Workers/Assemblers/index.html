<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Assemblers · FerriteAssembly.jl</title><meta name="title" content="Assemblers · FerriteAssembly.jl"/><meta property="og:title" content="Assemblers · FerriteAssembly.jl"/><meta property="twitter:title" content="Assemblers · FerriteAssembly.jl"/><meta name="description" content="Documentation for FerriteAssembly.jl."/><meta property="og:description" content="Documentation for FerriteAssembly.jl."/><meta property="twitter:description" content="Documentation for FerriteAssembly.jl."/><meta property="og:url" content="https://KnutAM.github.io/FerriteAssembly.jl/Workers/Assemblers/"/><meta property="twitter:url" content="https://KnutAM.github.io/FerriteAssembly.jl/Workers/Assemblers/"/><link rel="canonical" href="https://KnutAM.github.io/FerriteAssembly.jl/Workers/Assemblers/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">FerriteAssembly.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Learning by doing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/heat_equation/">Heat Equation</a></li><li><a class="tocitem" href="../../tutorials/viscoelasticity/">Viscoelasticity with state variables</a></li><li><a class="tocitem" href="../../tutorials/incompressible_elasticity/">Multiple fields</a></li><li><a class="tocitem" href="../../tutorials/mixed_materials/">Multiple materials</a></li><li><a class="tocitem" href="../../tutorials/iga/">Using <code>IGA.jl</code></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">How-to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../howto/threaded_assembly/">Threaded assembly</a></li><li><a class="tocitem" href="../../howto/automatic_differentiation/">Automatic differentiation</a></li><li><a class="tocitem" href="../../howto/local_constraints/">Local constraint application</a></li><li><a class="tocitem" href="../../howto/robin_bc/">Robin boundary conditions</a></li><li><a class="tocitem" href="../../howto/volume_integral/">Volume integration</a></li><li><a class="tocitem" href="../../howto/surface_integral/">Surface integration</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../design/">Design</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">DomainBuffers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../DomainBuffers/Setup/">DomainBuffers</a></li><li><a class="tocitem" href="../../DomainBuffers/StateVariables/">State variables</a></li><li><a class="tocitem" href="../../DomainBuffers/ItemBuffer/">ItemBuffer</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Workers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Workers/">Workers</a></li><li class="is-active"><a class="tocitem" href>Assemblers</a><ul class="internal"><li><a class="tocitem" href="#Available-assemblers"><span>Available assemblers</span></a></li><li><a class="tocitem" href="#Functions-to-overload"><span>Functions to overload</span></a></li><li><a class="tocitem" href="#Residual-scaling"><span>Residual scaling</span></a></li></ul></li><li><a class="tocitem" href="../Integrators/">Integrators</a></li><li><a class="tocitem" href="../QuadPointEvaluator/">Quadrature point eval</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Convenience</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Convenience/LoadHandler/">External loads</a></li><li><a class="tocitem" href="../../Convenience/MaterialModelsBase/">Mechanical materials</a></li><li><a class="tocitem" href="../../Convenience/ExampleElements/">Example elements</a></li></ul></li><li><a class="tocitem" href="../../Customization/">Customizations</a></li><li><a class="tocitem" href="../../internals/">Internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li><a class="is-disabled">Workers</a></li><li class="is-active"><a href>Assemblers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Assemblers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KnutAM/FerriteAssembly.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/main/docs/src/Workers/Assemblers.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Assemblers"><a class="docs-heading-anchor" href="#Assemblers">Assemblers</a><a id="Assemblers-1"></a><a class="docs-heading-anchor-permalink" href="#Assemblers" title="Permalink"></a></h1><p>Assemblers are used to assemble the system matrices and residual vectors. To calculate the contribution to these matrices, one or more of the following functions should be overloaded for the specific <code>material</code>:</p><ul><li><a href="#FerriteAssembly.element_routine!"><code>element_routine!</code></a></li><li><a href="#FerriteAssembly.element_residual!"><code>element_residual!</code></a></li><li><a href="#FerriteAssembly.facet_residual!"><code>facet_residual!</code></a></li><li><a href="#FerriteAssembly.facet_routine!"><code>facet_routine!</code></a></li></ul><h2 id="Available-assemblers"><a class="docs-heading-anchor" href="#Available-assemblers">Available assemblers</a><a id="Available-assemblers-1"></a><a class="docs-heading-anchor-permalink" href="#Available-assemblers" title="Permalink"></a></h2><p>The following assemblers can be used to assemble the system matrix and vector:</p><ul><li><a href="#Ferrite-assemblers"><code>Ferrite.start_assemble</code></a> (<code>AssemblerSparsityPattern</code> or <code>AssemblerSymmetricSparsityPattern</code>)</li><li><a href="#KeReAssembler"><code>KeReAssembler</code></a></li><li><a href="#ReAssembler"><code>ReAssembler</code></a></li></ul><h3 id="Ferrite-assemblers"><a class="docs-heading-anchor" href="#Ferrite-assemblers">Ferrite assemblers</a><a id="Ferrite-assemblers-1"></a><a class="docs-heading-anchor-permalink" href="#Ferrite-assemblers" title="Permalink"></a></h3><p>Ferrite assemblers are supported and are used to assemble both a matrix and a vector. They are created by calling Ferrite&#39;s <code>start_assemble</code> function. They will primarily call <code>element_routine!</code> or <code>facet_routine!</code>.  However, if not defined for the given material, automatic differentiation will be used to get the matrix contribution by calling <code>element_residual!</code> or <code>facet_residual!</code> instead.</p><h3 id="ReAssembler"><a class="docs-heading-anchor" href="#ReAssembler">ReAssembler</a><a id="ReAssembler-1"></a><a class="docs-heading-anchor-permalink" href="#ReAssembler" title="Permalink"></a></h3><p>The <code>ReAssembler</code> assembles only the residual vector, and will thus call <code>element_residual!</code> or <code>facet_residual!</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.ReAssembler" href="#FerriteAssembly.ReAssembler"><code>FerriteAssembly.ReAssembler</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ReAssembler(r; fillzero=true, scaling=NoScaling())</code></pre><p><code>ReAssembler</code> will call <code>element_residual!</code> and assemble <code>re</code> into the system  vector <code>r</code>. <code>fillzero=true</code> implies that <code>r</code> is zeroed upon construction of  <code>ReAssembler</code>. Furthermore, remaining keyword arguments can enable the following  features:</p><ul><li><code>scaling</code>: Calculate a scaling measure locally at the residual level, see e.g.,  <a href="#ElementResidualScaling"><code>ElementResidualScaling</code></a>. </li></ul><p><a href="../../Customization/#FerriteAssembly.reset_scaling!"><code>reset_scaling!</code></a> is called when creating <code>ReAssembler</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/Workers/Assemblers.jl#L33-L44">source</a></section></article><h3 id="KeReAssembler"><a class="docs-heading-anchor" href="#KeReAssembler">KeReAssembler</a><a id="KeReAssembler-1"></a><a class="docs-heading-anchor-permalink" href="#KeReAssembler" title="Permalink"></a></h3><p>The <code>KeReAssembler</code> assembles both the residual vector and the system matrix, similar to Ferrite&#39;s assemblers. It will also primarily call <code>element_routine!</code> or <code>facet_routine!</code> and fall back to automatic differentiation of <code>element_residual!</code> and <code>facet_residual!</code> if the former methods are not defined. </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.KeReAssembler" href="#FerriteAssembly.KeReAssembler"><code>FerriteAssembly.KeReAssembler</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">KeReAssembler(K, r; fillzero=true, kwargs...)
KeReAssembler(a::Ferrite.AbstractAssembler; kwargs...)</code></pre><p>The default <code>KeReAssembler</code> works just like a <code>Ferrite.AbstractAssembler</code>: It will call <code>element_routine!</code> and assemble <code>Ke</code> and <code>re</code> into the global system  matrix <code>K</code> and vector <code>r</code>. However, it comes with the additional possible features, that are controllable via the keyword arguments:</p><ul><li><code>ch::Union{Nothing,ConstraintHandler}=nothing</code>: If a <code>ConstraintHandler</code> is given, local applications of constraints will be applied, using <code>Ferrite.apply_assemble</code>.</li><li><code>apply_zero</code>: Required if a constraint handler is given, and forwarded to <code>Ferrite.apply_assemble</code>. </li><li><code>scaling</code>: Calculate a scaling measure locally at the residual level, see e.g.,  <a href="#ElementResidualScaling"><code>ElementResidualScaling</code></a></li></ul><p><code>a=Ferrite.start_assemble(K, r; fillzero=fillzero)</code> is passed to the second definition  if a matrix, <code>K</code>, and vector, <code>r</code>, are given as input.</p><p><a href="../../Customization/#FerriteAssembly.reset_scaling!"><code>reset_scaling!</code></a> is called when creating <code>KeReAssembler</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/Workers/Assemblers.jl#L86-L104">source</a></section></article><h2 id="Functions-to-overload"><a class="docs-heading-anchor" href="#Functions-to-overload">Functions to overload</a><a id="Functions-to-overload-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-to-overload" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.element_routine!" href="#FerriteAssembly.element_routine!"><code>FerriteAssembly.element_routine!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">element_routine!(
    Ke::AbstractMatrix, re::AbstractVector, state,
    ae::AbstractVector, material, cellvalues, buffer)</code></pre><p>The main function to be overloaded for the specific <code>material</code>. In most cases, the same implementation can be used for different cellvalues  (e.g. for different interpolation orders) This function should modify the element stiffness matrix <code>Ke</code>, the residual <code>re</code>, and potentially <code>state</code>. The element degree of freedom values, <code>ae</code>, are filled by  <code>NaN</code>s unless <code>a</code> is passed to <a href="../Workers/#FerriteAssembly.work!"><code>work!</code></a>.</p><p>The following variables can be obtained from <code>buffer</code>.</p><ul><li><a href="../../DomainBuffers/ItemBuffer/#FerriteAssembly.get_old_state"><code>get_old_state(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#FerriteAssembly.get_aeold"><code>get_aeold(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#FerriteAssembly.get_time_increment"><code>get_time_increment(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#Ferrite.dof_range-Tuple{FerriteAssembly.AbstractItemBuffer, Symbol}"><code>dof_range(buffer, fieldname::Symbol)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#Ferrite.getcoordinates-Tuple{FerriteAssembly.AbstractItemBuffer}"><code>getcoordinates(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#Ferrite.celldofs-Tuple{FerriteAssembly.AbstractItemBuffer}"><code>celldofs(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#Ferrite.cellid-Tuple{FerriteAssembly.AbstractItemBuffer}"><code>cellid(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#FerriteAssembly.get_user_data"><code>get_user_data(buffer)</code></a></li><li><a href="../../DomainBuffers/ItemBuffer/#FerriteAssembly.get_user_cache"><code>get_user_cache(buffer)</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/FerriteAssembly.jl#L40-L62">source</a></section><section><div><pre><code class="language-julia hljs">FerriteAssembly.element_routine!(
    Ke, re, state::Vector{&lt;:MMB.AbstractMaterialState}, ae, 
    m::MMB.AbstractMaterial, cv::AbstractCellValues, buffer)</code></pre><p>Solve the weak form </p><p class="math-container">\[   \int_\Omega [\boldsymbol{\delta u}\otimes\nabla]^\mathrm{sym} : \boldsymbol{\sigma}\ \mathrm{d}\Omega 
   = \int_\Gamma \boldsymbol{\delta u} \cdot \boldsymbol{t}\ \mathrm{d}\Gamma 
   + \int_\Omega \boldsymbol{\delta u} \cdot \boldsymbol{b}\ \mathrm{d}\Omega\]</p><p>where <span>$\sigma$</span> is calculated with the <code>material_response</code> function from  <a href="https://github.com/KnutAM/MaterialModelsBase.jl"><code>MaterialModelsBase.jl</code></a>.  Note that <code>create_cell_state</code> is already implemented for <code>&lt;:AbstractMaterial</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/Utils/MaterialModelsBase.jl#L3-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.element_residual!" href="#FerriteAssembly.element_residual!"><code>FerriteAssembly.element_residual!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">element_residual!(
    re::AbstractVector, state,
    ae::AbstractVector, material, cellvalues, buffer)</code></pre><p>To calculate the element tangent stiffness <code>Ke</code> automatically by using <code>ForwardDiff</code>, it is possible to overload <code>element_residual!</code> instead of <code>element_routine!</code>. See  <a href="#FerriteAssembly.element_routine!"><code>element_routine!</code></a> for a description of the input parameters. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p><code>MethodError</code> with <code>ForwardDiff.Dual</code><br/>When using automatic differentiation for elements with state variables (or other mutating values in e.g. cache), an error will be thrown if trying to change the type in many cases.  When mutating <code>state</code>, call <code>ForwardDiff.value()</code> on the value to be assigned <strong>after</strong>  it will no longer be used to calculate <code>re</code>. (If done on a value which is later affects <code>re</code> inside the element, the tangent, <code>Ke</code>, will be wrong.)</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/FerriteAssembly.jl#L65-L81">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.facet_routine!" href="#FerriteAssembly.facet_routine!"><code>FerriteAssembly.facet_routine!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">facet_routine!(Ke, re, ae, material, facetvalues, facetbuffer)</code></pre><p>Calculate contributions to the stiffness matrix and residual vector from a  facet domain. It can be used, for example, to implement Robin boundary conditions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/FerriteAssembly.jl#L84-L89">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.facet_residual!" href="#FerriteAssembly.facet_residual!"><code>FerriteAssembly.facet_residual!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">facet_residual!(re, ae, material, facetvalues, facetbuffer)</code></pre><p>Calculate contributions to the residual vector from a facet domain.  Internally, this is used for calculating Neumann boundary conditions. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/FerriteAssembly.jl#L92-L97">source</a></section></article><h2 id="Residual-scaling"><a class="docs-heading-anchor" href="#Residual-scaling">Residual scaling</a><a id="Residual-scaling-1"></a><a class="docs-heading-anchor-permalink" href="#Residual-scaling" title="Permalink"></a></h2><p>There are many options for how to scale the residual in finite element simulations. This package does not intend to implement many different options, but does give the  user the option to calculate scaling contributions from each cell, which may be useful. By defining a <code>scaling</code> that is passed to <a href="#KeReAssembler"><code>KeReAssembler</code></a> or <a href="#ReAssembler"><code>ReAssembler</code></a>, it can be updated based on the output from each cell. </p><p>One type of scaling, <a href="#ElementResidualScaling"><code>ElementResidualScaling</code></a>, is included as described below. Its code can be used as a template for how to include custom scaling that works on the element level.</p><h3 id="ElementResidualScaling"><a class="docs-heading-anchor" href="#ElementResidualScaling">ElementResidualScaling</a><a id="ElementResidualScaling-1"></a><a class="docs-heading-anchor-permalink" href="#ElementResidualScaling" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FerriteAssembly.ElementResidualScaling" href="#FerriteAssembly.ElementResidualScaling"><code>FerriteAssembly.ElementResidualScaling</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ElementResidualScaling(dh::AbstractDofHandler, p=Val(2), T=Float64)</code></pre><p>Create tolerance scaling based on the sum of the p-norm of each cell&#39;s residual vector,  separately for each field. I.e. pseudo-code for field <code>:u</code> the scaling <code>factor::T</code> is</p><pre><code class="nohighlight hljs">for each cell
    element_routine!(Ke, re, args...) # Calculate re
    factor += sum(abs.(re[dof_range(dh, :u)]).^p)^(1/p)</code></pre><p>Note that <code>p=Val(2)</code> is a special case that is supported, for different values  it should be given as a <code>Real</code>. <code>p=2</code> is equivalent to <code>Val(2)</code>, but is less efficient. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FerriteAssembly.jl/blob/d30a01f34d61311bf1721d89dc474241ee5f5ae1/src/Utils/scaling.jl#L26-L38">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Workers/">« Workers</a><a class="docs-footer-nextpage" href="../Integrators/">Integrators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 27 November 2024 16:10">Wednesday 27 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
